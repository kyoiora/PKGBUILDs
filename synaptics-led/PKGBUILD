# Maintainer: Matthew Monaco <dgbaley27@0x01b.net>

_kver=3.1
_modpath=lib/modules/extramodules-$_kver-ARCH

pkgname=synaptics-led
pkgver=$_kver
pkgrel=1

arch=(i686 x86_64)
license=(GPL2)
url="https://github.com/mmonaco/synaptics-led"
pkgdesc="Synaptics LED enabled psmouse kernel module"
depends=("linux>=3.1" "linux<3.2")
makedepends=("linux-headers")

install=${pkgname}.install

source=(
	ftp://ftp.kernel.org/pub/linux/kernel/v3.x/linux-${_kver}.tar.xz
	synled.patch
)

md5sums=(
	edbdc798f23ae0f8045c82f6fa22c536
	57ac8a6ae1656cde97213d4882fa4a87
)

build() {

	cd "${srcdir}/linux-$_kver"
	
	rsync -r /usr/src/linux-$(uname -r)/ .
	echo "CONFIG_MOUSE_PS2_SYNAPTICS_LED=y" >> .config
	patch -Np1 -i "${srcdir}/synled.patch"

	make drivers/input/mouse/psmouse.ko
}

package() {

	src="${srcdir}/linux-${_kver}/drivers/input/mouse"
	dst="${pkgdir}/${_modpath}"

	install -D -m 0644 "${src}/psmouse.ko" "${dst}/psmouse.ko"

	gzip -9 "${dst}/psmouse.ko"
}
