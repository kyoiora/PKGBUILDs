# $Id: PKGBUILD 64899 2012-02-18 19:57:32Z bpiotrowski $
# Maintainer:  Bart≈Çomiej Piotrowski <nospam@bpiotrowski.pl>
# Contributor: Brad Fanella <bradfanella@archlinux.us>
# Contributor: Andrea Scarpino <andrea@archlinux.org>
# Contributor: tobias <tobias@archlinux.org>

pkgname=openbox
pkgver=3.5.0
pkgrel=6
pkgdesc="A window manager for the X11 windowing system"
arch=('i686' 'x86_64')
url="http://openbox.org"
license=('GPL')
depends=('startup-notification' 'libxml2' 'libxinerama' 'libxrandr'
         'libxcursor' 'pango' 'imlib2')
optdepends=('pyxdg: for the xdg-autostart script')
groups=('lxde')
install=${pkgname}.install
options=('!libtool')
backup=('etc/xdg/openbox/menu.xml' 'etc/xdg/openbox/rc.xml')
source=(
        'openbox-3.5.0-moveresize_end-safety-check.patch'
        'which-2.20.patch')
md5sums=(
         'e09d77842aac9a0cd7eebe112df88383'
         '7ca3b5244bb092d46f5bcf1e2bdf4a18')

__gitroot="git://git.openbox.org/dana/openbox.git"

build() {
	cd "$srcdir"

	if [[ -d "$pkgname" ]]; then
		msg2 "Pulling from $__gitroot"
		pushd "$pkgname"
		git pull
		popd
	else
		msg2 "Cloning $__gitroot"
		git clone "$__gitroot"
	fi

	git clone "$pkgname" "$pkgname-$pkgver"

  	cd "${srcdir}"/${pkgname}-${pkgver}

  	# FS#11455
  	patch -p1 -i "${srcdir}"/which-2.20.patch
  	sed -i 's|/usr/bin/env python|/usr/bin/env python2|' \
  		data/autostart/openbox-xdg-autostart

	patch -p1 -i "$srcdir/openbox-3.5.0-moveresize_end-safety-check.patch"
  
	./bootstrap
	./configure --prefix=/usr \
    		--with-x \
    		--enable-startup-notification \
    		--sysconfdir=/etc \
		    --libexecdir=/usr/lib/openbox
  
	make
}

package() {
  	cd "${srcdir}"/${pkgname}-${pkgver}
  	make DESTDIR="${pkgdir}" install

  	#sed -i "s:startkde:/usr/bin/\0:" \
  	#	"${pkgdir}"/usr/share/xsessions/openbox-kde.desktop
  	#sed -i "s:=gnome-session:=/usr/bin/gnome-session:" \
    	#	"${pkgdir}"/usr/share/xsessions/openbox-gnome.desktop
}
